generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  otp          String?  
  otpExpiresAt DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  orders       Order[]   // ðŸ‘ˆ new
  profile      Profile?
}

model Profile {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  phone     String
  address   String
  user      User?    @relation(fields: [userId], references: [id])
  userId    Int?     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  products  Product[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          Int           @id @default(autoincrement())
  name        String
  description String?
  price       Float         @default(0)
  category    Category      @relation(fields: [categoryId], references: [id])
  categoryId  Int
  images      ProductImage[]
  cartItems   CartItem[]
  orderItems  OrderItem[]   // ðŸ‘ˆ new
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  url       String
  product   Product  @relation(fields: [productId], references: [id])
  productId Int
  createdAt DateTime @default(now())
}

model Cart {
  id         Int        @id @default(autoincrement())
  userId     Int?
  items      CartItem[]
  orders     Order[]     // ðŸ‘ˆ new (ek cart se multiple orders ho sakte hain)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

model CartItem {
  id        Int      @id @default(autoincrement())
  cart      Cart     @relation(fields: [cartId], references: [id])
  cartId    Int
  product   Product  @relation(fields: [productId], references: [id])
  productId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id              Int          @id @default(autoincrement())
  orderNumber     String       @unique
  userId          Int?
  user            User?        @relation(fields: [userId], references: [id])

  cartId          Int?
  cart            Cart?        @relation(fields: [cartId], references: [id])

  items           OrderItem[]
  totalAmount     Float
  currency        String       @default("INR")

  razorpayOrderId String?
  status          OrderStatus  @default(PENDING)

  shippingName    String?
  shippingPhone   String?
  shippingAddress String?

  payments        Payment[]    // ðŸ‘ˆ ye line zaroor honi chahiye

  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  order     Order    @relation(fields: [orderId], references: [id])
  orderId   Int
  product   Product  @relation(fields: [productId], references: [id])
  productId Int
  quantity  Int      @default(1)
  price     Float    // snapshot of price at time of order
}

model Payment {
  id               Int        @id @default(autoincrement())
  order            Order      @relation(fields: [orderId], references: [id])
  orderId          Int
  amount           Float
  currency         String     @default("INR")

  razorpayOrderId  String
  razorpayPaymentId String?
  razorpaySignature String?

  status           PaymentStatus @default(PENDING)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

enum OrderStatus {
  PENDING
  PAID
  FAILED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}
